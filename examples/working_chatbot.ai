# Working Chatbot Example
# This example addresses the issues found in the user report

# Environment variables needed
environment:
  OPENAI_API_KEY: "your-openai-api-key-here"
  PORT: "8000"

# Model configuration
model chat_model:
  provider: openai
  name: "gpt-3.5-turbo"
  temperature: 0.7
  max_tokens: 1000

# Memory for conversation history
memory "conversation_history":
  scope: conversation
  kind: conversation
  max_items: 50

# Chain for processing chat messages
chain "chat_response":
  inputs:
    message: text
    history: conversation
    
  steps:
    - step analyze_input:
        model: chat_model
        prompt: |
          Analyze this user message for intent and topic.
          Message: {{message}}
          
          Respond with a JSON object containing:
          - intent: string (question, request, casual, etc.)
          - topic: string
          - needs_context: boolean
        output: analysis
        
    - step generate_response:
        model: chat_model
        prompt: |
          You are a helpful AI assistant. Generate a conversational response to the user's message.
          
          User message: {{message}}
          Message analysis: {{analysis}}
          Conversation history: {{history}}
          
          Guidelines:
          - Be helpful and engaging
          - Keep responses concise but informative
          - Use the conversation history for context
          - Maintain a friendly tone
        output: response

# API endpoints
endpoint "/api/chat" {
  method: post
  
  inputs:
    message: text
    
  chain: chat_response
  
  using:
    message: inputs.message
    history: memory.conversation_history
    
  stores:
    user_message: inputs.message
    ai_response: chain.response
    
  memory_updates:
    conversation_history: [
      {role: "user", content: inputs.message},
      {role: "assistant", content: chain.response}
    ]
    
  returns:
    response: chain.response
    timestamp: now()
}

endpoint "/api/health" {
  method: get
  
  returns:
    status: "healthy"
    version: "1.0.0"
    timestamp: now()
}

# Frontend UI - simplified declarative syntax
# The Namel3ss runtime automatically generates the full HTML/CSS/JS
ui chatbot:
  type: chat
  title: "Namel3ss AI Chatbot"
  subtitle: "Powered by namel3ss programming language"
  
  theme:
    primary: "#667eea"
    secondary: "#764ba2"
    background: gradient(135deg, primary, secondary)
    border_radius: 16px
    
  layout:
    width: 600px
    height: 600px
    
  chat_config:
    endpoint: "/api/chat"
    input_placeholder: "Type your message..."
    send_button_text: "Send"
    loading_text: "Thinking..."
    welcome_message: "Hello! I am your AI assistant. How can I help you today?"
    
  features:
    - auto_scroll
    - error_handling
    - loading_states
    - keyboard_submit